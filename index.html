<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ØªÙ† ÙÙŠØ² â€” Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)</title>
  <style>
    :root{ --bg:#f3f7ff; --ink:#0b2340; --muted:#6b7a90; --card:#fff; --shadow:0 10px 28px rgba(11,35,64,.12);
           --primary:#2563eb; --accent:#22c55e; --warn:#ef4444; --gold:#fbbf24; --silver:#c0c7d1; }
    *{box-sizing:border-box}
    body{font-family:Tahoma,Arial,sans-serif;background:linear-gradient(180deg,#f0f6ff 0%, #f8fbff 40%, #ffffff 100%);min-height:100vh;margin:0;padding:16px;color:var(--ink)}
    .container{max-width:1100px;margin:0 auto; padding-bottom:110px;}
    .card{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-bottom:16px}
    .hero{padding:18px 20px;background:linear-gradient(90deg,#e8f0ff,#fff);display:flex;align-items:center;gap:14px;border:1px solid #e6eefc}
    .badge{background:#eef4ff;color:#234; padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid #dbe7ff}
    h1{font-size:22px;margin:6px 0}
    p{margin:0;color:var(--muted)}
    input, select, button{font-size:16px}
    input[type=text], input[type=number], select{padding:12px 14px;border-radius:12px;border:1px solid #d8e4f5;background:#fafcff;outline:none;transition:.2s}
    input[type=number]{text-align:left; direction:ltr}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .toolbar, .entry, .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .entry input, .entry select{flex:1;min-width:120px}
    .toolbar button, .entry button{min-height:44px}
    button{padding:12px 16px;border-radius:12px;border:0;background:var(--primary);color:#fff;cursor:pointer;transition:.06s;box-shadow:0 6px 16px rgba(37,99,235,.18)}
    button.ghost{background:#eaf2ff;color:#123;border:1px solid #d7e6ff;box-shadow:none}
    button.warn{background:var(--warn)}
    button.good{background:var(--accent)}
    .table-wrap{overflow:auto;-webkit-overflow-scrolling:touch;border-radius:12px;border:1px solid #e8f1ff}
    table{width:max(900px,100%);border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eef4fb;text-align:center;white-space:nowrap}
    tbody tr:nth-child(odd){background:#fcfeff}
    .first{background:linear-gradient(90deg,#fffbeb,#fff4cc); border-inline-start:6px solid var(--gold)}
    .second{background:linear-gradient(90deg,#f7f8fc,#eef2f7); border-inline-start:6px solid var(--silver)}
    .last{background:linear-gradient(90deg,#fff1f2,#ffe4e6); border-inline-start:6px solid var(--warn)}
    .toast{position:fixed;inset-inline:0;bottom:90px;margin:auto;max-width:360px;background:#0b2340;color:#fff;padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(12px);pointer-events:none;transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
    @media (max-width: 640px){
      body{padding:12px}
      .container{padding:0; padding-bottom:120px;}
      .hero{flex-direction:column;align-items:flex-start}
      .entry input, .entry select{flex:1;min-width:0}
      th,td{padding:8px 6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card hero">
      <div class="badge">ØªÙ† ÙÙŠØ² â€” Ø£ÙˆÙÙ„Ø§ÙŠÙ†</div>
      <div>
        <h1>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ³Ø¬ÙŠÙ„ Ù†Ù‚Ø§Ø·</h1>
        <p>Ø£Ù‚Ù„ Ù…Ø¬Ù…ÙˆØ¹ Ù‡Ùˆ Ø§Ù„ÙØ§Ø¦Ø² ğŸ‘‘ â€” Ø¢Ø®Ø± ØªØ±ØªÙŠØ¨ = Ø§Ù„ÙƒÙˆØ² ğŸª£</p>
      </div>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ -->
    <div class="card">
      <div class="row">
        <input id="playerName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
        <button id="addPlayer" class="good">+ Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨</button>
        <button id="clearAll" class="warn">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>
      <p style="margin-top:8px;color:#6b7a90;font-size:13px">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªØªØ®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ (localStorage).</p>
    </div>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø© Ø¬ÙˆÙ„Ø© -->
    <div class="card">
      <div class="entry">
        <select id="playerSelect" title="Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨"></select>
        <select id="roundSelect" title="Ø§Ù„Ø¬ÙˆÙ„Ø©"></select>
        <input id="scoreInput" type="number" inputmode="numeric" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø©">
        <button id="saveScore" class="good">Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
        <button id="clearMine" class="ghost">Ù…Ø³Ø­ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
        <button id="deletePlayer" class="warn">Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
      </div>
      <p style="margin-top:8px;color:#6b7a90;font-size:12px">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø«Ø§Ø¨Øª Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ ØªØ¨Ù‚Ù‰ Ù…Ø±ÙŠØ­Ø©ØŒ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ¹Ø±Ø¶ ÙÙ‚Ø·.</p>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© -->
    <div class="card">
      <div class="toolbar">
        <button id="calc" class="good">Ø§Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨</button>
        <button id="exportBtn" class="ghost">ØªØµØ¯ÙŠØ± (Ù†Ø³Ø®)</button>
        <button id="importBtn" class="ghost">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
      </div>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="card">
      <div class="table-wrap">
        <table id="playersTable">
          <thead>
            <tr id="theadRow">
              <th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
              <!-- Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ØªØªÙˆÙ„Ø¯ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ Ù‡Ù†Ø§ -->
              <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
              <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
            </tr>
          </thead>
          <tbody id="playersBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const ROUNDS = 10;
    const STORAGE_KEY = 'phaseten_offline_v1';
    let players = [];

    const els = {
      name: document.getElementById('playerName'),
      add: document.getElementById('addPlayer'),
      clearAll: document.getElementById('clearAll'),
      selPlayer: document.getElementById('playerSelect'),
      selRound: document.getElementById('roundSelect'),
      score: document.getElementById('scoreInput'),
      save: document.getElementById('saveScore'),
      clearMine: document.getElementById('clearMine'),
      delPlayer: document.getElementById('deletePlayer'),
      calc: document.getElementById('calc'),
      export: document.getElementById('exportBtn'),
      import: document.getElementById('importBtn'),
      toast: document.getElementById('toast'),
      thead: document.getElementById('theadRow'),
      body: document.getElementById('playersBody'),
    };

    function toast(msg){ els.toast.textContent = msg; els.toast.classList.add('show'); setTimeout(()=>els.toast.classList.remove('show'), 1800); }
    function uid(){ return Math.random().toString(36).slice(2,8).toUpperCase(); }
    function asNum(v){ const n=Number(v); return Number.isFinite(n)? n : null; }
    function total(scores){ return (scores||[]).reduce((s,v)=>s+(Number.isFinite(v)?v:0),0); }

    function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(players)); }
    function loadLocal(){ try{ const raw=localStorage.getItem(STORAGE_KEY); players = raw? JSON.parse(raw) : []; }catch{ players=[]; } }

    function buildHeader(){
      // Ø§Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
      els.thead.innerHTML = '';

      const thName = document.createElement('th');
      thName.textContent = 'Ø§Ù„Ù„Ø§Ø¹Ø¨';
      els.thead.appendChild(thName);

      for (let r = 1; r <= ROUNDS; r++) {
        const th = document.createElement('th');
        th.textContent = 'Ø¬ÙˆÙ„Ø© ' + r;
        els.thead.appendChild(th);
      }

      const thTotal = document.createElement('th');
      thTotal.textContent = 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹';
      els.thead.appendChild(thTotal);

      const thRank = document.createElement('th');
      thRank.textContent = 'Ø§Ù„ØªØ±ØªÙŠØ¨';
      els.thead.appendChild(thRank);
    }

    function drawTable(){
      const arr = players.map(p=>({...p, total: total(p.scores)}));
      arr.sort((a,b)=> a.total - b.total);
      let rank=1;
      for(let i=0;i<arr.length;i++){
        if(i>0 && arr[i].total === arr[i-1].total) arr[i].rank = arr[i-1].rank;
        else { arr[i].rank = rank; }
        rank++;
      }
      const worst = arr.length? arr[arr.length-1].total : null;

      els.body.innerHTML='';
      arr.forEach(p=>{
        const tr=document.createElement('tr');
        if(p.rank===1) tr.classList.add('first');
        else if(p.rank===2) tr.classList.add('second');
        if(p.total===worst) tr.classList.add('last');

        const tdName=document.createElement('td');
        tdName.textContent = p.name || 'â€”';
        tr.appendChild(tdName);

        for(let r=0;r<ROUNDS;r++){
          const td=document.createElement('td');
          td.textContent = (p.scores[r]!=null)? p.scores[r] : 'â€”';
          tr.appendChild(td);
        }

        const tdTotal=document.createElement('td'); tdTotal.textContent = total(p.scores); tr.appendChild(tdTotal);

        const tdRank=document.createElement('td');
        let label = p.rank;
        if(p.rank===1) label = 'Ø§Ù„Ø£ÙˆÙ„ ğŸ‘‘';
        else if(p.rank===2) label = 'Ø§Ù„Ø«Ø§Ù†ÙŠ';
        if(p.total===worst) label = 'Ø§Ù„ÙƒÙˆØ² ğŸª£';
        tdRank.textContent = label;
        tr.appendChild(tdRank);

        els.body.appendChild(tr);
      });

      rebuildSelect();
    }

    function rebuildSelect(){
      const cur = els.selPlayer.value;
      els.selPlayer.innerHTML='';
      players.forEach(p=>{
        const opt=document.createElement('option');
        opt.value=p.id; opt.textContent=p.name;
        els.selPlayer.appendChild(opt);
      });
      if(players.length===0){ const opt=document.createElement('option'); opt.value=''; opt.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ†'; els.selPlayer.appendChild(opt); }
      else if(!players.find(p=>p.id===cur)){ els.selPlayer.value = players[players.length-1].id; }
      else { els.selPlayer.value = cur; }
    }

    function rebuildRoundSelect(){
      els.selRound.innerHTML='';
      for(let r=1;r<=ROUNDS;r++){
        const opt=document.createElement('option');
        opt.value=r; opt.textContent='Ø¬ÙˆÙ„Ø© '+r;
        els.selRound.appendChild(opt);
      }
      els.selRound.value = '1';
    }

    els.add.addEventListener('click', ()=>{
      const name = (els.name.value||'').trim();
      if(!name){ toast('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨'); return; }
      players.push({id:uid(), name, scores:Array(ROUNDS).fill(null)});
      els.name.value='';
      saveLocal(); drawTable();
      toast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨');
    });

    els.clearAll.addEventListener('click', ()=>{
      if(!confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§ØªØŸ')) return;
      players=[]; saveLocal(); drawTable();
      toast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„');
    });

    els.save.addEventListener('click', ()=>{
      const id = els.selPlayer.value;
      const r = Math.max(1, Math.min(ROUNDS, Number(els.selRound.value)||1)) - 1;
      const v = asNum(els.score.value);
      if(!id || !players.find(p=>p.id===id)){ toast('Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ù‹Ø§'); return; }
      if(v===null){ toast('Ø§ÙƒØªØ¨ Ø¯Ø±Ø¬Ø© ØµØ­ÙŠØ­Ø©'); return; }
      const p = players.find(p=>p.id===id);
      p.scores[r] = v;
      saveLocal(); drawTable();
      toast(`Ø§ØªØ­ÙØ¸Øª Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø© ${r+1}`);
      els.score.value = '';
    });

    els.clearMine.addEventListener('click', ()=>{
      const id = els.selPlayer.value;
      const p = players.find(p=>p.id===id);
      if(!p){ toast('Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ù‹Ø§'); return; }
      p.scores = Array(ROUNDS).fill(null);
      saveLocal(); drawTable();
      toast('Ø§ØªÙ…Ø³Ø­Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„Ø§Ø¹Ø¨');
    });

    els.delPlayer.addEventListener('click', ()=>{
      const id = els.selPlayer.value;
      const p = players.find(p=>p.id===id);
      if(!p){ toast('Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ù‹Ø§'); return; }
      if(!confirm('Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ')) return;
      players = players.filter(x=>x.id!==id);
      saveLocal(); drawTable();
      toast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨');
    });

    els.calc.addEventListener('click', ()=>{
      drawTable();
      if(players.length){
        const totals = players.map(p=>({name:p.name, t:total(p.scores)})).sort((a,b)=>a.t-b.t);
        const best = totals[0].t, worst = totals[totals.length-1].t;
        const winners = totals.filter(x=>x.t===best).map(x=>x.name).join('ØŒ ');
        const kooz    = totals.filter(x=>x.t===worst).map(x=>x.name).join('ØŒ ');
        toast(`Ø§Ù„ÙØ§Ø¦Ø²: ${winners} â€” Ø§Ù„ÙƒÙˆØ²: ${kooz}`);
      } else {
        toast('Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ù‹Ø§');
      }
    });

    els.export.addEventListener('click', ()=>{
      const data = JSON.stringify(players);
      navigator.clipboard?.writeText(data).then(()=> toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©')).catch(()=>{});
    });
    els.import.addEventListener('click', ()=>{
      const txt = prompt('Ø§Ù„ØµÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ù‘Ø±Ø© (JSON):');
      if(!txt) return;
      try{
        const arr = JSON.parse(txt);
        if(!Array.isArray(arr)) throw new Error('bad');
        players = arr;
        saveLocal(); drawTable();
        toast('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
      }catch{ toast('ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); }
    });

    loadLocal();
    buildHeader();
    rebuildRoundSelect();
    drawTable();
  </script>
</body>
</html>
